<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
>

<head>
    <script type="text/javascript">
        var baseUri = window.location.href;
        wsUri = baseUri.concat('test').concat("/");
        wsUri = wsUri.replace("http", "ws");
        var kafkaSocket = null;


        function listen() {

            // var baseUri = window.location.href;     // Returns full URL
            // console.log(baseUri);
            // wsUri = baseUri.concat('test').concat("/");
            // wsUri = wsUri.replace("http", "ws");
            // console.log(wsUri);

            kafkaSocket = new WebSocket(wsUri);

            kafkaSocket.onopen = function () {
                console.log('Connected!');
                // kafkaSocket.send('Ping'); // Send the message 'Ping' to the server
            };
            kafkaSocket.onmessage = function (event) {
                // console.log(event.data);
                window.location.reload();
            };
        }

        // listen();
        function closeConnection() {
            kafkaSocket.close();
        }

    </script>


</head>
<body onload="listen();" onunload="closeConnection();">
<div id="ordersTable">
    <h:dataTable value="#{consumerService.orderStatus}" var="order">

        <h:column>
            <f:facet name="header">Order Id</f:facet>
            #{order.orderId}
        </h:column>

        <h:column>
            <f:facet name="header">Drivers</f:facet>

            #{order.drivers.size() eq 0? "no drivers assigned" : order.drivers}

        </h:column>

        <h:column>
            <f:facet name="header">Is Order Comleted</f:facet>
            #{order.completed ? "Completed" : "Not completed"}
        </h:column>

        <h:column>
            <f:facet name="header">Truck</f:facet>

            #{order.truck == null ? "no trucks assigned" : order.truck}

        </h:column>

        <h:column>
            <f:facet name="header">Total points on route</f:facet>
            #{order.numOfPointsTotal}
        </h:column>

        <h:column>
            <f:facet name="header">Completed points</f:facet>
            #{order.numOfCompletedPoints}
        </h:column>
    </h:dataTable>
</div>


<div id="driversTable">
    <table>
        <thead>
        <tr>
            <th scope="col">Total Drivers</th>
            <th scope="col">Rest Drivers</th>
        </tr>
        <tr>
            <td>#{consumerService.driverStatus.totalDrivers}</td>
            <td>#{consumerService.driverStatus.driversOnRest}</td>
        </tr>

        </thead>
    </table>
</div>

<div id="trucksTable">
    <table>
        <thead>
        <tr>
            <th scope="col">Total Trucks</th>
            <th scope="col">Broken trucks</th>
            <th scope="col">Rest trucks</th>

        </tr>
        <tr>
            <td>#{consumerService.truckStatus.totalTrucksNumber}</td>
            <td>#{consumerService.truckStatus.totalBrokenNumber}</td>
            <td>#{consumerService.truckStatus.totalRestNumber}</td>

        </tr>


        </thead>
    </table>
</div>
</body>


</html>
